

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Git under the hood &mdash; Introduction to version control with Git  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=9c3e77be" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="../_static/style.css?v=791bfbd6" />

  
    <link rel="shortcut icon" href="../_static/coderefinery.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=187304be"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=582ca9e2"></script>
      <script src="../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=1ae7504c"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script data-domain="coderefinery.github.io" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Quick reference" href="../reference/" />
    <link rel="prev" title="Aliases and configuration" href="../aliases/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Introduction to version control with Git
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../motivation/">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuring Git command line and editor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modifying an existing project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../browsing/">Copy and browse an existing project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commits/">Recording changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../merging/">Merging changes and contributing to the project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../local-workflow/">Cloning a Git repository and working locally</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Studying an existing project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../archaeology/">Inspecting history</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sharing your work</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sharing/">How to turn your project to a Git repo and share it</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finding the balance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../level/">Practical advice: How much Git is necessary?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../what-to-avoid/">What to avoid</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Older episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../branches/">Branching and merging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conflicts/">Conflict resolution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optional episodes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../staging-area/">Using the Git staging area</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recovering/">Undoing and recovering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interrupted/">Interrupted work</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aliases/">Aliases and configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Git under the hood</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#down-the-rabbit-hole">Down the rabbit hole</a></li>
<li class="toctree-l2"><a class="reference internal" href="#git-is-basically-a-content-addressed-storage-system">Git is basically a content-addressed storage system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#demonstration-experimenting-with-branches">Demonstration: experimenting with branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#demonstration-if-you-add-it-you-don-t-lose-it-for-a-while">Demonstration: If you add it, you don’t lose it (for a while)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://youtu.be/xbTTDLA3txI">Shell crash course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/">Quick reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customizing/">Customizing Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/">Other resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.github.io/git-intro/lesson.pdf">PDF version</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/core/">All lessons</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/">CodeRefinery</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/reusing/">Reusing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Introduction to version control with Git</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Git under the hood</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/git-intro/blob/main/content/under-the-hood.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="git-under-the-hood">
<h1>Git under the hood<a class="headerlink" href="#git-under-the-hood" title="Link to this heading"></a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Verify that branches are pointers to commits and extremely lightweight.</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>10 min teaching/type-along</p></li>
<li><p>15 min exercise</p></li>
</ul>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/stranger.jpg"><img alt="Git under the hood" src="../_images/stranger.jpg" style="width: 100%;" />
</a>
</figure>
<section id="down-the-rabbit-hole">
<h2>Down the rabbit hole<a class="headerlink" href="#down-the-rabbit-hole" title="Link to this heading"></a></h2>
<p>When working with Git, <strong>you will never need to go inside .git</strong>, but in this
exercise we will, in order to learn about how branches are implemented in Git.</p>
<p>For this exercise create a new repository and commit a couple of changes.</p>
<p>Now that we’ve made a couple of commits let us look at what is happening under
the hood.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>.git
<span class="gp">$ </span>ls<span class="w"> </span>-l

<span class="go">drwxr-xr-x   - user 25 Aug 15:51 branches</span>
<span class="go">.rw-r--r-- 499 user 25 Aug 15:52 COMMIT_EDITMSG</span>
<span class="go">.rw-r--r--  92 user 25 Aug 15:51 config</span>
<span class="go">.rw-r--r--  73 user 25 Aug 15:51 description</span>
<span class="go">.rw-r--r--  21 user 25 Aug 15:51 HEAD</span>
<span class="go">drwxr-xr-x   - user 25 Aug 15:51 hooks</span>
<span class="go">.rw-r--r-- 137 user 25 Aug 15:52 index</span>
<span class="go">drwxr-xr-x   - user 25 Aug 15:51 info</span>
<span class="go">drwxr-xr-x   - user 25 Aug 15:52 logs</span>
<span class="go">drwxr-xr-x   - user 25 Aug 15:52 objects</span>
<span class="go">drwxr-xr-x   - user 25 Aug 15:51 refs</span>
</pre></div>
</div>
<p>Git stores everything under the .git folder in your repository. In fact, <strong>the
.git directory is the Git repository.</strong></p>
<p>Previously when you wrote the commit messages using your text editor, they
were in fact saved to <code class="docutils literal notranslate"><span class="pre">COMMIT_EDITMSG</span></code>.</p>
<p>Each commit in Git is stored as an object. This object contains information about
the author and the commit message. A <em>commit object</em> references a <em>tree object</em> that lists
the files present in the directory at the time.
Tree objects reference <em>blob</em> objects (that record the state of each file)
or other tree objects.</p>
<p>Commits are referenced by a SHA-1 hash (a 40-character hexadecimal string).</p>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../_images/commit-and-tree.png"><img alt="A commit inside Git" src="../_images/commit-and-tree.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">States of a Git file. Image from the <a class="reference external" href="https://git-scm.com/book/">Pro Git book</a>. License CC BY 3.0.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Once you have several commits, each commit object also links to the hash of the
previous commit(s) (there is more than one previous commit for for merge commits).
The commits form a <a class="reference external" href="http://eagain.net/articles/git-for-computer-scientists/">directed acyclic graph</a>
(do not worry if the term is not familiar).</p>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="../_images/commits-and-parents.png"><img alt="A commit and its parents" src="../_images/commits-and-parents.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">A commit and its parents. Image from the <a class="reference external" href="https://git-scm.com/book/">Pro Git book</a>. License CC BY 3.0.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>All branches and tags in Git are pointers to commits.</p>
</section>
<section id="git-is-basically-a-content-addressed-storage-system">
<h2>Git is basically a content-addressed storage system<a class="headerlink" href="#git-is-basically-a-content-addressed-storage-system" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>CAS: <a class="reference external" href="https://en.wikipedia.org/wiki/Content-addressable_storage">“mechanism for storing information that can be retrieved based on its content, not its storage location”</a></p></li>
<li><p>Content address is the content digest (SHA-1 checksum)</p></li>
<li><p>Stored data does not change - so when we modify commits, we always create new
commits.  Git doesn’t delete these right away, which is why it is <em>very hard
to lose data if you commit it once</em>.</p></li>
</ul>
<p>Let us poke a bit into raw objects! Start with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>cat-file<span class="w"> </span>-p<span class="w"> </span>HEAD
</pre></div>
</div>
<p>Then explore the <code class="docutils literal notranslate"><span class="pre">tree</span></code> object, then the <code class="docutils literal notranslate"><span class="pre">file</span></code> object, etc. recursively using the hashes you see.</p>
</section>
<section id="demonstration-experimenting-with-branches">
<h2>Demonstration: experimenting with branches<a class="headerlink" href="#demonstration-experimenting-with-branches" title="Link to this heading"></a></h2>
<p>Let us lift the hood and create few branches manually.  The
goal of this exercise is to hopefully create an “Aha!” moment and provide us a
good understanding of the underlying model.</p>
<p>We are starting from the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch and create an <code class="docutils literal notranslate"><span class="pre">idea</span></code> branch:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>status

<span class="go">On branch main</span>
<span class="go">nothing to commit, working tree clean</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>switch<span class="w"> </span>--create<span class="w"> </span>idea

<span class="go">Switched to a new branch &#39;idea&#39;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>branch

<span class="go">* idea</span>
<span class="go">  main</span>
</pre></div>
</div>
<p>Now let us go in:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>.git
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>refs/heads
<span class="gp">$ </span>ls<span class="w"> </span>-l

<span class="go">.rw-r--r-- 41 user 25 Aug 15:54 idea</span>
<span class="go">.rw-r--r-- 41 user 25 Aug 15:52 main</span>
</pre></div>
</div>
<p>Let us check what the <code class="docutils literal notranslate"><span class="pre">idea</span></code> file looks like
(do not worry if the hash is different):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat<span class="w"> </span>idea

<span class="go">045e3db14740c60684d745e5fb891ae71e335611</span>
</pre></div>
</div>
<p>Now let us replicate this file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cp<span class="w"> </span>idea<span class="w"> </span>idea-2
<span class="gp">$ </span>cp<span class="w"> </span>idea<span class="w"> </span>idea-3
<span class="gp">$ </span>cp<span class="w"> </span>idea<span class="w"> </span>idea-4
<span class="gp">$ </span>cp<span class="w"> </span>idea<span class="w"> </span>idea-5
</pre></div>
</div>
<p>Let us go up two levels and inspect the file <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>../..
<span class="gp">$ </span>cat<span class="w"> </span>HEAD

<span class="go">ref: refs/heads/idea</span>
</pre></div>
</div>
<p>Let us open this file and change it to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">/</span><span class="n">heads</span><span class="o">/</span><span class="n">idea</span><span class="o">-</span><span class="mi">3</span>
</pre></div>
</div>
<p><strong>Now we are ready for the aha moment!</strong>
First let us go back to the working area:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>..
</pre></div>
</div>
<p>Now - on which branch are we?</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>branch

<span class="go">  idea</span>
<span class="go">  idea-2</span>
<span class="go">* idea-3</span>
<span class="go">  idea-4</span>
<span class="go">  idea-5</span>
<span class="go">  main</span>
</pre></div>
</div>
</section>
<section id="demonstration-if-you-add-it-you-don-t-lose-it-for-a-while">
<h2>Demonstration: If you add it, you don’t lose it (for a while)<a class="headerlink" href="#demonstration-if-you-add-it-you-don-t-lose-it-for-a-while" title="Link to this heading"></a></h2>
<p>A common way to (apparently) lose work
is to use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> indiscriminately.</p>
<p>You make some changes to a file,
(let us call this version A)
you <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> them,
then you make some other changes
(let us call this version B)
and you <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> those again.</p>
<p>Now version A is apparently lost,
and if we realize that we need it back
we typically click nervously on the “undo” arrow of our editor.</p>
<p>But fear not! Try this.</p>
<ol class="arabic simple">
<li><p>Create a file named <code class="docutils literal notranslate"><span class="pre">test-add</span></code> with the following command:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;Once a file has been git added, it is hard to lose!&#39;</span> <span class="o">&gt;</span> <span class="n">test</span><span class="o">-</span><span class="n">add</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Add it to the repository</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>add<span class="w"> </span>test-add
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Now change the content of the file to be</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ops</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>And repeat the add command</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>add<span class="w"> </span>test-add
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Apparently we have lost the previous version of the file.
But it is actually there, stored in a <em>dangling</em> blob object
(which is not referenced by any other objects)
We can see this with the command <code class="docutils literal notranslate"><span class="pre">fsck</span></code>:</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>fsck
<span class="go">Checking object directories: 100% (256/256), done.</span>
<span class="go">dangling blob dc3b15f60045eea7a87639436ed75021130579e0</span>
</pre></div>
</div>
<p>We can see the content of that blob
by passing its hash (shortened for convenience)
to the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">cat-file</span> <span class="pre">-p</span></code> command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>cat-file<span class="w"> </span>-p<span class="w"> </span>dc3b
<span class="go">Once a file has been git added, it is hard to lose!</span>
</pre></div>
</div>
<div class="admonition-discussion discussion important admonition" id="discussion-0">
<p class="admonition-title">Discussion</p>
<p>Discuss the findings with other course participants.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../aliases/" class="btn btn-neutral float-left" title="Aliases and configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../reference/" class="btn btn-neutral float-right" title="Quick reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright CodeRefinery contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>